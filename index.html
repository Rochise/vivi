<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ViagerPro - Calculateur de Rentabilit√©</title>
    <meta name="description"
        content="Calculez la rentabilit√© d'un investissement en viager avec carte interactive des prix au m¬≤.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="grid-background"></div>
    <div class="glow-top"></div>

    <div class="app">
        <header class="header">
            <div class="container">
                <div class="header-content">
                    <div class="logo">
                        <div class="logo-icon">V</div>
                        <div class="logo-text">Viager<span>Pro</span></div>
                    </div>
                    <div class="badge">v1.1 Beta</div>
                </div>
            </div>
        </header>

        <section class="hero">
            <div class="container">
                <div class="hero-badge">Calculateur intelligent avec carte</div>
                <h1>Analysez votre <span class="gradient">investissement viager</span></h1>
                <p class="hero-subtitle">
                    Visualisez les prix au m¬≤ par quartier et estimez votre rentabilit√©
                </p>
            </div>
        </section>

        <main class="main">
            <div class="container">
                <!-- Map Section -->
                <section class="map-section">
                    <div class="card map-card">
                        <div class="card-header">
                            <div class="card-icon">üó∫Ô∏è</div>
                            <h2 class="card-title">Carte des prix au m¬≤</h2>
                        </div>
                        <div class="map-content">
                            <div class="address-search">
                                <div class="form-group">
                                    <label for="addressInput">Adresse du bien</label>
                                    <div class="input-wrapper">
                                        <input type="text" id="addressInput" placeholder="Entrez l'adresse exacte..."
                                            autocomplete="off">
                                        <div id="addressSuggestions" class="suggestions-list"></div>
                                    </div>
                                </div>
                                <div class="address-info" id="addressInfo">
                                    <div class="info-item">
                                        <span class="info-label">Commune</span>
                                        <span class="info-value" id="communeName">‚Äî</span>
                                    </div>
                                    <div class="info-item">
                                        <span class="info-label">Prix moyen</span>
                                        <span class="info-value highlight" id="avgPrice">‚Äî</span>
                                    </div>
                                    <div class="info-item">
                                        <span class="info-label">Transactions</span>
                                        <span class="info-value" id="transactionCount">‚Äî</span>
                                    </div>
                                </div>
                            </div>
                            <div id="map" class="map-container"></div>
                            <div class="map-legend">
                                <div class="legend-header">
                                    <div class="legend-title">Prix au m¬≤ - <span id="legendCity">France</span></div>
                                    <div class="legend-update">Mis √† jour : <span id="legendDate">Janvier 2026</span>
                                    </div>
                                </div>
                                <div class="legend-scale" id="legendScale">
                                    <div class="legend-item">
                                        <span class="legend-color" style="background: #22c55e;"></span>
                                        <span id="legendLow">&lt; 3 000 ‚Ç¨</span>
                                    </div>
                                    <div class="legend-item">
                                        <span class="legend-color" style="background: #84cc16;"></span>
                                        <span id="legendMedLow">3 000 - 5 000 ‚Ç¨</span>
                                    </div>
                                    <div class="legend-item">
                                        <span class="legend-color" style="background: #eab308;"></span>
                                        <span id="legendMed">5 000 - 7 000 ‚Ç¨</span>
                                    </div>
                                    <div class="legend-item">
                                        <span class="legend-color" style="background: #f97316;"></span>
                                        <span id="legendMedHigh">7 000 - 10 000 ‚Ç¨</span>
                                    </div>
                                    <div class="legend-item">
                                        <span class="legend-color" style="background: #ef4444;"></span>
                                        <span id="legendHigh">&gt; 10 000 ‚Ç¨</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Calculator Section -->
                <div class="calculator-layout">
                    <form id="viagerForm">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-icon">üè†</div>
                                <h2 class="card-title">Le bien</h2>
                            </div>
                            <div class="card-body">
                                <div class="form-grid">
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="propertyPrice">Prix du march√©</label>
                                            <div class="input-wrapper">
                                                <input type="number" id="propertyPrice" placeholder="300000" min="0">
                                                <span class="input-suffix">‚Ç¨</span>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="surface">Surface</label>
                                            <div class="input-wrapper">
                                                <input type="number" id="surface" placeholder="80" min="0">
                                                <span class="input-suffix">m¬≤</span>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="divider"></div>

                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="bouquet">Bouquet</label>
                                            <div class="input-wrapper">
                                                <input type="number" id="bouquet" placeholder="80000" min="0">
                                                <span class="input-suffix">‚Ç¨</span>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="rente">Rente mensuelle</label>
                                            <div class="input-wrapper">
                                                <input type="number" id="rente" placeholder="800" min="0">
                                                <span class="input-suffix">‚Ç¨</span>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="taxeFonciere">Taxe fonci√®re (annuelle)</label>
                                            <div class="input-wrapper">
                                                <input type="number" id="taxeFonciere" placeholder="1500" min="0">
                                                <span class="input-suffix">‚Ç¨/an</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="card" style="margin-top: 16px;">
                            <div class="card-header">
                                <div class="card-icon">üë§</div>
                                <h2 class="card-title">Le vendeur</h2>
                            </div>
                            <div class="card-body">
                                <div class="form-grid">
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="age">√Çge</label>
                                            <div class="input-wrapper">
                                                <input type="number" id="age" placeholder="75" min="50" max="110">
                                                <span class="input-suffix">ans</span>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="gender">Sexe</label>
                                            <select id="gender">
                                                <option value="female">Femme</option>
                                                <option value="male">Homme</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="disease">Pathologie principale</label>
                                        <select id="disease">
                                            <optgroup label="Aucune pathologie">
                                                <option value="none">Bonne sant√©</option>
                                                <option value="minor">Pathologies mineures (hypertension contr√¥l√©e...)
                                                </option>
                                            </optgroup>
                                            <optgroup label="Maladies cardiovasculaires">
                                                <option value="heart_failure">Insuffisance cardiaque</option>
                                                <option value="coronary">Maladie coronarienne (infarctus)</option>
                                                <option value="stroke">AVC / Accident vasculaire c√©r√©bral</option>
                                                <option value="arrhythmia">Arythmie cardiaque s√©v√®re</option>
                                            </optgroup>
                                            <optgroup label="Cancers">
                                                <option value="cancer_remission">Cancer en r√©mission (+5 ans)</option>
                                                <option value="cancer_prostate">Cancer de la prostate</option>
                                                <option value="cancer_breast">Cancer du sein</option>
                                                <option value="cancer_colon">Cancer colorectal</option>
                                                <option value="cancer_lung">Cancer du poumon</option>
                                                <option value="cancer_pancreas">Cancer du pancr√©as</option>
                                            </optgroup>
                                            <optgroup label="Maladies respiratoires">
                                                <option value="copd_moderate">BPCO mod√©r√©e</option>
                                                <option value="copd_severe">BPCO s√©v√®re</option>
                                                <option value="pulmonary_fibrosis">Fibrose pulmonaire</option>
                                            </optgroup>
                                            <optgroup label="Maladies m√©taboliques">
                                                <option value="diabetes_controlled">Diab√®te de type 2 contr√¥l√©</option>
                                                <option value="diabetes_complications">Diab√®te avec complications
                                                </option>
                                                <option value="renal_failure">Insuffisance r√©nale chronique</option>
                                                <option value="cirrhosis">Cirrhose h√©patique</option>
                                            </optgroup>
                                            <optgroup label="Maladies neurologiques">
                                                <option value="alzheimer_early">Alzheimer stade pr√©coce</option>
                                                <option value="alzheimer_advanced">Alzheimer stade avanc√©</option>
                                                <option value="parkinson">Maladie de Parkinson</option>
                                                <option value="als">SLA (Scl√©rose lat√©rale amyotrophique)</option>
                                            </optgroup>
                                        </select>
                                    </div>
                                    <div class="disease-info" id="diseaseInfo" style="display: none;">
                                        <div class="disease-impact"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Second person (optional) -->
                        <div class="card" style="margin-top: 16px;">
                            <div class="card-header" style="cursor: pointer;" onclick="toggleSecondPerson()">
                                <div class="card-icon">üë•</div>
                                <h2 class="card-title">2√®me vendeur (couple)</h2>
                                <div class="toggle-indicator" id="toggleIndicator">+ Ajouter</div>
                            </div>
                            <div class="card-body" id="secondPersonSection" style="display: none;">
                                <div class="couple-info">
                                    <span class="info-icon">‚ÑπÔ∏è</span>
                                    <span>Viager sur 2 t√™tes : le viager se poursuit jusqu'au d√©c√®s du dernier
                                        survivant. Les personnes en couple b√©n√©ficient d'un bonus d'esp√©rance de vie de
                                        +10% (√©tudes INSEE/INED).</span>
                                </div>
                                <div class="form-grid">
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="age2">√Çge</label>
                                            <div class="input-wrapper">
                                                <input type="number" id="age2" placeholder="72" min="50" max="110">
                                                <span class="input-suffix">ans</span>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="gender2">Sexe</label>
                                            <select id="gender2">
                                                <option value="male">Homme</option>
                                                <option value="female">Femme</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="disease2">Pathologie principale</label>
                                        <select id="disease2">
                                            <optgroup label="Aucune pathologie">
                                                <option value="none">Bonne sant√©</option>
                                                <option value="minor">Pathologies mineures (hypertension contr√¥l√©e...)
                                                </option>
                                            </optgroup>
                                            <optgroup label="Maladies cardiovasculaires">
                                                <option value="heart_failure">Insuffisance cardiaque</option>
                                                <option value="coronary">Maladie coronarienne (infarctus)</option>
                                                <option value="stroke">AVC / Accident vasculaire c√©r√©bral</option>
                                                <option value="arrhythmia">Arythmie cardiaque s√©v√®re</option>
                                            </optgroup>
                                            <optgroup label="Cancers">
                                                <option value="cancer_remission">Cancer en r√©mission (+5 ans)</option>
                                                <option value="cancer_prostate">Cancer de la prostate</option>
                                                <option value="cancer_breast">Cancer du sein</option>
                                                <option value="cancer_colon">Cancer colorectal</option>
                                                <option value="cancer_lung">Cancer du poumon</option>
                                                <option value="cancer_pancreas">Cancer du pancr√©as</option>
                                            </optgroup>
                                            <optgroup label="Maladies respiratoires">
                                                <option value="copd_moderate">BPCO mod√©r√©e</option>
                                                <option value="copd_severe">BPCO s√©v√®re</option>
                                                <option value="pulmonary_fibrosis">Fibrose pulmonaire</option>
                                            </optgroup>
                                            <optgroup label="Maladies m√©taboliques">
                                                <option value="diabetes_controlled">Diab√®te de type 2 contr√¥l√©</option>
                                                <option value="diabetes_complications">Diab√®te avec complications
                                                </option>
                                                <option value="renal_failure">Insuffisance r√©nale chronique</option>
                                                <option value="cirrhosis">Cirrhose h√©patique</option>
                                            </optgroup>
                                            <optgroup label="Maladies neurologiques">
                                                <option value="alzheimer_early">Alzheimer stade pr√©coce</option>
                                                <option value="alzheimer_advanced">Alzheimer stade avanc√©</option>
                                                <option value="parkinson">Maladie de Parkinson</option>
                                                <option value="als">SLA (Scl√©rose lat√©rale amyotrophique)</option>
                                            </optgroup>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <button type="submit" class="submit-btn" style="margin-top: 16px; width: 100%;">
                            Calculer la rentabilit√©
                        </button>
                    </form>

                    <aside class="results-panel" id="resultsPanel">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-icon">üìä</div>
                                <h2 class="card-title">Analyse compl√®te</h2>
                            </div>
                            <div class="card-body" id="resultsBody" style="display: none;">
                                <div class="results-section">
                                    <div class="section-title">Valeur du bien</div>
                                    <div class="results-stack">
                                        <div class="result-row">
                                            <span class="result-label">Valeur estim√©e (m¬≤ √ó prix)</span>
                                            <span class="result-value" id="estimatedValue">‚Äî</span>
                                        </div>
                                        <div class="result-row">
                                            <span class="result-label">Prix du march√© saisi</span>
                                            <span class="result-value" id="marketPrice">‚Äî</span>
                                        </div>
                                        <div class="result-row">
                                            <span class="result-label">Prix au m¬≤ r√©el</span>
                                            <span class="result-value" id="realPriceM2">‚Äî</span>
                                        </div>
                                    </div>
                                </div>

                                <div class="results-section">
                                    <div class="section-title">Dur√©e & Esp√©rance</div>
                                    <div class="results-stack">
                                        <div class="result-row">
                                            <span class="result-label">Pathologie</span>
                                            <span class="result-value" id="diseaseDisplay">‚Äî</span>
                                        </div>
                                        <div class="result-row">
                                            <span class="result-label">Esp√©rance base (sans maladie)</span>
                                            <span class="result-value" id="baseExpectancy">‚Äî</span>
                                        </div>
                                        <div class="result-row result-disease">
                                            <span class="result-label">Impact maladie</span>
                                            <span class="result-value" id="diseaseImpact">‚Äî</span>
                                        </div>
                                        <div class="result-row">
                                            <span class="result-label">Esp√©rance ajust√©e</span>
                                            <span class="result-value" id="lifeExpectancy">‚Äî</span>
                                        </div>
                                        <div class="result-row">
                                            <span class="result-label">Dur√©e viager estim√©e</span>
                                            <span class="result-value" id="duration">‚Äî</span>
                                        </div>
                                        <div class="result-row">
                                            <span class="result-label">Coefficient DUH</span>
                                            <span class="result-value" id="duhCoef">‚Äî</span>
                                        </div>
                                    </div>
                                </div>

                                <div class="results-section">
                                    <div class="section-title">D√©tail des co√ªts</div>
                                    <div class="results-stack">
                                        <div class="result-row">
                                            <span class="result-label">Bouquet initial</span>
                                            <span class="result-value" id="bouquetDisplay">‚Äî</span>
                                        </div>
                                        <div class="result-row">
                                            <span class="result-label">Total rentes estim√©es</span>
                                            <span class="result-value" id="totalRentes">‚Äî</span>
                                        </div>
                                        <div class="result-row">
                                            <span class="result-label">Total taxes fonci√®res</span>
                                            <span class="result-value" id="totalTaxesFoncieres">‚Äî</span>
                                        </div>
                                        <div class="result-row">
                                            <span class="result-label">Frais de notaire (~8%)</span>
                                            <span class="result-value" id="notaryFees">‚Äî</span>
                                        </div>
                                        <div class="result-row result-total">
                                            <span class="result-label">Co√ªt total d'acquisition</span>
                                            <span class="result-value" id="totalCost">‚Äî</span>
                                        </div>
                                    </div>
                                </div>

                                <div class="results-section">
                                    <div class="section-title">Analyse viager</div>
                                    <div class="results-stack">
                                        <div class="result-row">
                                            <span class="result-label">Valeur DUH (occupation)</span>
                                            <span class="result-value" id="duhValue">‚Äî</span>
                                        </div>
                                        <div class="result-row">
                                            <span class="result-label">Valeur nue-propri√©t√©</span>
                                            <span class="result-value" id="bareOwnership">‚Äî</span>
                                        </div>
                                        <div class="result-row">
                                            <span class="result-label">√âcart bouquet/nue-prop.</span>
                                            <span class="result-value" id="bouquetDiff">‚Äî</span>
                                        </div>
                                    </div>
                                </div>

                                <div class="results-section">
                                    <div class="section-title">Rentabilit√©</div>
                                    <div class="results-stack">
                                        <div class="result-row result-highlight">
                                            <span class="result-label">√âconomie vs achat direct</span>
                                            <span class="result-value" id="savings">‚Äî</span>
                                        </div>
                                        <div class="result-row result-main">
                                            <span class="result-label">Rentabilit√© estim√©e</span>
                                            <span class="result-value" id="profitability">‚Äî</span>
                                        </div>
                                    </div>
                                </div>

                                <div class="results-section">
                                    <div class="section-title"
                                        style="display: flex; justify-content: space-between; align-items: center;">
                                        <span>Seuil de non-rentabilit√©</span>
                                        <button type="button" class="detail-btn" id="breakEvenBtn"
                                            onclick="toggleBreakEvenDetails()">
                                            üìâ Voir d√©tails
                                        </button>
                                    </div>
                                    <div class="results-stack">
                                        <div class="result-row result-warning">
                                            <span class="result-label">Dur√©e avant perte</span>
                                            <span class="result-value" id="breakEvenDuration">‚Äî</span>
                                        </div>
                                        <div class="result-row">
                                            <span class="result-label">Date estim√©e de non-rentabilit√©</span>
                                            <span class="result-value" id="breakEvenDate">‚Äî</span>
                                        </div>
                                    </div>
                                    <div class="break-even-details" id="breakEvenDetails" style="display: none;">
                                        <div class="detail-card">
                                            <div class="detail-title">üìä Analyse d√©taill√©e du seuil</div>
                                            <div class="detail-row">
                                                <span>Valeur du bien</span>
                                                <span id="bePropertyValue">‚Äî</span>
                                            </div>
                                            <div class="detail-row">
                                                <span>Bouquet initial</span>
                                                <span id="beBouquet">‚Äî</span>
                                            </div>
                                            <div class="detail-row">
                                                <span>Rente mensuelle</span>
                                                <span id="beRente">‚Äî</span>
                                            </div>
                                            <div class="detail-row">
                                                <span>Taxe fonci√®re annuelle</span>
                                                <span id="beTaxe">‚Äî</span>
                                            </div>
                                            <div class="detail-row">
                                                <span>Frais de notaire</span>
                                                <span id="beNotary">‚Äî</span>
                                            </div>
                                            <div class="detail-divider"></div>
                                            <div class="detail-row highlight">
                                                <span>Co√ªt mensuel total</span>
                                                <span id="beMonthlyCost">‚Äî</span>
                                            </div>
                                            <div class="detail-row highlight">
                                                <span>Marge restante apr√®s bouquet</span>
                                                <span id="beMargin">‚Äî</span>
                                            </div>
                                            <div class="detail-row highlight">
                                                <span>Mois avant d√©passement</span>
                                                <span id="beMonths">‚Äî</span>
                                            </div>
                                            <div class="detail-explanation">
                                                <strong>üí° Explication :</strong> Le viager n'est plus rentable lorsque
                                                la somme du bouquet, des rentes cumul√©es, des taxes fonci√®res et des
                                                frais de notaire d√©passe la valeur du bien.
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="disclaimer">
                                    <span class="disclaimer-icon">‚ö†Ô∏è</span>
                                    <span>Estimations bas√©es sur les tables de mortalit√© INSEE et un coefficient DUH
                                        standard. La dur√©e r√©elle peut varier significativement.</span>
                                </div>
                            </div>
                            <div class="empty-state" id="emptyState">
                                <div class="empty-state-icon">üìä</div>
                                <p class="empty-state-text">Remplissez le formulaire pour l'analyse</p>
                            </div>
                        </div>
                    </aside>
                </div>
            </div>
        </main>

        <footer class="footer">
            <div class="container">
                <p>Donn√©es DVF ‚Äî data.gouv.fr ‚Ä¢ Carte OpenStreetMap</p>
            </div>
        </footer>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="app.js"></script>
</body>

</html>